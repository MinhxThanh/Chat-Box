/*! For license information please see contentScript.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}function n(){"use strict";n=function(){return r};var t,r={},o=Object.prototype,i=o.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function u(e,t,n,r){return Object.defineProperty(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r})}try{u({},"")}catch(t){u=function(e,t,n){return e[t]=n}}function d(e,n,r,o){var i=n&&n.prototype instanceof h?n:h,a=Object.create(i.prototype);return u(a,"_invoke",function(e,n,r){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var s=C(c,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===o)throw o=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=3;var l=p(e,n,r);if("normal"===l.type){if(o=r.done?4:2,l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=4,r.method="throw",r.arg=l.arg)}}}(e,r,new T(o||[])),!0),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}r.wrap=d;var f={};function h(){}function m(){}function g(){}var b={};u(b,c,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(j([])));v&&v!==o&&i.call(v,c)&&(b=v);var w=g.prototype=h.prototype=Object.create(b);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(t,n){function r(o,a,c,s){var l=p(t[o],t,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==e(d)&&i.call(d,"__await")?n.resolve(d.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):n.resolve(d).then((function(e){u.value=e,c(u)}),(function(e){return r("throw",e,c,s)}))}s(l.arg)}var o;u(this,"_invoke",(function(e,t){function i(){return new n((function(n,o){r(e,t,n,o)}))}return o=o?o.then(i,i):i()}),!0)}function C(e,n){var r=n.method,o=e.i[r];if(o===t)return n.delegate=null,"throw"===r&&e.i.return&&(n.method="return",n.arg=t,C(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var i=p(o,e.i,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,f;var a=i.arg;return a?a.done?(n[e.r]=a.value,n.next=e.n,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,f):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function E(e){this.tryEntries.push(e)}function S(e){var n=e[4]||{};n.type="normal",n.arg=t,e[4]=n}function T(e){this.tryEntries=[[-1]],e.forEach(E,this),this.reset(!0)}function j(n){if(null!=n){var r=n[c];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var o=-1,a=function e(){for(;++o<n.length;)if(i.call(n,o))return e.value=n[o],e.done=!1,e;return e.value=t,e.done=!0,e};return a.next=a}}throw new TypeError(e(n)+" is not iterable")}return m.prototype=g,u(w,"constructor",g),u(g,"constructor",m),m.displayName=u(g,l,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,l,"GeneratorFunction")),e.prototype=Object.create(w),e},r.awrap=function(e){return{__await:e}},x(k.prototype),u(k.prototype,s,(function(){return this})),r.AsyncIterator=k,r.async=function(e,t,n,o,i){void 0===i&&(i=Promise);var a=new k(d(e,t,n,o),i);return r.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(w),u(w,l,"Generator"),u(w,c,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},r.values=j,T.prototype={constructor:T,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(t){a.type="throw",a.arg=e,n.next=t}for(var o=n.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],c=this.prev,s=i[1],l=i[2];if(-1===i[0])return r("end"),!1;if(!s&&!l)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=c){if(c<s)return this.method="next",this.arg=t,r(s),!0;if(c<l)return r(l),!1}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var o=r;break}}o&&("break"===e||"continue"===e)&&o[0]<=t&&t<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o[2],f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[2]===e)return this.complete(n[4],n[3]),S(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[0]===e){var r=n[4];if("throw"===r.type){var o=r.arg;S(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={i:j(e),r:n,n:r},"next"===this.method&&(this.arg=t),f}},r}function r(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){s(i,r,o,a,c,"next",e)}function c(e){s(i,r,o,a,c,"throw",e)}a(void 0)}))}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,p(r.key),r)}}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(t,n,r){return n=v(n),function(t,n){if(n&&("object"==e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(t,b()?Reflect.construct(n,r||[],v(t).constructor):n.apply(t,r))}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function g(e){var t="function"==typeof Map?new Map:void 0;return g=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(b())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var o=new(e.bind.apply(e,r));return n&&y(o,n.prototype),o}(e,arguments,v(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),y(n,e)},g(e)}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(b=function(){return!!e})()}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var w=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,x="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36,gzip(gfe)",k=/<text start="([^"]*)" dur="([^"]*)">([^<]*)<\/text>/g,C=function(e){function t(e){return f(this,t),h(this,t,["[YoutubeTranscript] ðŸš¨ ".concat(e)])}return m(t,e),d(t)}(g(Error)),E=function(e){function t(){return f(this,t),h(this,t,["YouTube is receiving too many requests from this IP and now requires solving a captcha to continue"])}return m(t,e),d(t)}(C),S=function(e){function t(e){return f(this,t),h(this,t,["The video is no longer available (".concat(e,")")])}return m(t,e),d(t)}(C),T=function(e){function t(e){return f(this,t),h(this,t,["Transcript is disabled on this video (".concat(e,")")])}return m(t,e),d(t)}(C),j=function(e){function t(e){return f(this,t),h(this,t,["No transcripts are available for this video (".concat(e,")")])}return m(t,e),d(t)}(C),O=function(e){function t(e,n,r){return f(this,t),h(this,t,["No transcripts are available in ".concat(e," this video (").concat(r,"). Available languages: ").concat(n.join(", "))])}return m(t,e),d(t)}(C),P=function(){return d((function e(){f(this,e)}),null,[{key:"fetchTranscript",value:(e=l(n().mark((function e(t,i){var c,s,l,u,d,p,f,h,m,g,b;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.retrieveVideoId(t),e.next=3,fetch("https://www.youtube.com/watch?v=".concat(s),{headers:a(a({},(null==i?void 0:i.lang)&&{"Accept-Language":i.lang}),{},{"User-Agent":x})});case 3:return l=e.sent,e.next=6,l.text();case 6:if(u=e.sent,!((d=u.split('"captions":')).length<=1)){e.next=14;break}if(!u.includes('class="g-recaptcha"')){e.next=11;break}throw new E;case 11:if(u.includes('"playabilityStatus":')){e.next=13;break}throw new S(t);case 13:throw new T(t);case 14:if(p=null===(c=function(){try{return JSON.parse(d[1].split(',"videoDetails')[0].replace("\n",""))}catch(e){return}}())||void 0===c?void 0:c.playerCaptionsTracklistRenderer){e.next=17;break}throw new T(t);case 17:if("captionTracks"in p){e.next=19;break}throw new j(t);case 19:if(null==i||!i.lang||p.captionTracks.some((function(e){return e.languageCode===i.lang}))){e.next=21;break}throw new O(i.lang,p.captionTracks.map((function(e){return e.languageCode})),t);case 21:if(f=null!=i&&i.lang?p.captionTracks.find((function(e){return e.languageCode===i.lang})):p.captionTracks.find((function(e){return"asr"!==e.kind}))||p.captionTracks[0]){e.next=24;break}throw new j(t+(null!=i&&i.lang?" for language ".concat(i.lang):""));case 24:return h=f.baseUrl,e.next=27,fetch(h,{headers:a(a({},(null==i?void 0:i.lang)&&{"Accept-Language":i.lang}),{},{"User-Agent":x})});case 27:if((m=e.sent).ok){e.next=30;break}throw new j(t);case 30:return e.next=32,m.text();case 32:return g=e.sent,n=g.matchAll(k),b=function(e){if(Array.isArray(e))return o(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||r(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),e.abrupt("return",b.map((function(e){return{text:e[3].replace(/&amp;#(\d+);/g,(function(e,t){return String.fromCharCode(t)})).replace(/&amp;quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;amp;/g,"&"),duration:parseFloat(e[2]),offset:parseFloat(e[1]),lang:(null==i?void 0:i.lang)||f.languageCode}})));case 35:case"end":return e.stop()}var n}),e,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"retrieveVideoId",value:function(e){if(11===e.length)return e;var t=e.match(w);if(t&&t.length)return t[1];throw new C("Impossible to retrieve Youtube video ID.")}}]);var e}();function I(){var e=document.createElement("div");e.id="chat-box-video-summary",e.className="chat-box-video-summary",Object.assign(e.style,{backgroundColor:"#282828",color:"white",padding:"16px",borderRadius:"12px",border:"none",width:"calc(100% - 32px)",maxHeight:"500px",overflowY:"auto",marginBottom:"20px",marginTop:"20px",fontSize:"14px",lineHeight:"1.5",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",position:"relative",display:"none"}),e.style.scrollbarWidth="thin",e.style.scrollbarColor="rgba(255,255,255,0.2) rgba(0,0,0,0)";var t=document.createElement("div");t.id="video-summary-actions",Object.assign(t.style,{display:"none",justifyContent:"flex-end",gap:"10px",marginTop:"16px",paddingTop:"10px",borderTop:"1px solid rgba(255,255,255,0.1)"});var n=document.createElement("button");n.innerHTML='Copy <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" style="display: inline-block; vertical-align: middle; margin-left: 8px;">\n    <path d="M9 15C9 12.1716 9 10.7574 9.87868 9.87868C10.7574 9 12.1716 9 15 9L16 9C18.8284 9 20.2426 9 21.1213 9.87868C22 10.7574 22 12.1716 22 15V16C22 18.8284 22 20.2426 21.1213 21.1213C20.2426 22 18.8284 22 16 22H15C12.1716 22 10.7574 22 9.87868 21.1213C9 20.2426 9 18.8284 9 16L9 15Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />\n    <path d="M16.9999 9C16.9975 6.04291 16.9528 4.51121 16.092 3.46243C15.9258 3.25989 15.7401 3.07418 15.5376 2.90796C14.4312 2 12.7875 2 9.5 2C6.21252 2 4.56878 2 3.46243 2.90796C3.25989 3.07417 3.07418 3.25989 2.90796 3.46243C2 4.56878 2 6.21252 2 9.5C2 12.7875 2 14.4312 2.90796 15.5376C3.07417 15.7401 3.25989 15.9258 3.46243 16.092C4.51121 16.9528 6.04291 16.9975 9 16.9999" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />\n</svg>',Object.assign(n.style,{backgroundColor:"hsl(249, 50%, 60%)",color:"white",border:"none",borderRadius:"8px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",transition:"all 0.2s ease-in-out"});var r=n.innerHTML;n.addEventListener("click",(function(){var e=document.getElementById("chat-box-summary-content");if(e){var t=e.innerText;navigator.clipboard.writeText(t).then((function(){n.innerHTML='Copied <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-left: 8px;"><polyline points="20 6 9 17 4 12"></polyline></svg>',setTimeout((function(){n.innerHTML=r}),2e3)})).catch((function(e){return console.error("Failed to copy text: ",e)}))}}));var o=document.createElement("button");o.innerHTML='Open Sidebar <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" style="display: inline-block; vertical-align: middle; margin-left: 8px;">\n    <path opacity="0.4" d="M13 8.5H13.5V4.69635C13.5 4.31176 13.8118 4 14.1963 4C14.39 4 14.5749 4.08062 14.7066 4.22252L20.6598 10.6336C20.8785 10.8691 21 11.1786 21 11.5C21 11.8214 20.8785 12.1309 20.6598 12.3664L14.7066 18.7775C14.5749 18.9194 14.39 19 14.1963 19C13.8118 19 13.5 18.6882 13.5 18.3037V14.5C7.94555 14.5 4.94688 18.5162 4.19199 19.6847C4.06738 19.8776 3.85713 20 3.6275 20C3.28094 20 3 19.7191 3 19.3725V18.5C3 12.9772 7.47715 8.5 13 8.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />\n    <path d="M13.5 8.5V4.69635C13.5 4.31176 13.8118 4 14.1963 4C14.39 4 14.5749 4.08062 14.7066 4.22252L20.6598 10.6336C20.8785 10.8691 21 11.1786 21 11.5C21 11.8214 20.8785 12.1309 20.6598 12.3664L14.7066 18.7775C14.5749 18.9194 14.39 19 14.1963 19C13.8118 19 13.5 18.6882 13.5 18.3037V14.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />\n</svg>',Object.assign(o.style,{backgroundColor:"rgba(255, 255, 255, 0.1)",color:"white",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",padding:"10px 16px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",transition:"all 0.2s ease-in-out"}),o.addEventListener("click",(function(){chrome.runtime.sendMessage({action:"openSidebar"})})),t.append(n,o),n.addEventListener("mouseover",(function(){n.style.backgroundColor="hsl(249, 50%, 70%)",n.style.transform="translateY(-2px)"})),n.addEventListener("mouseout",(function(){n.style.backgroundColor="hsl(249, 50%, 60%)",n.style.transform="translateY(0)"})),o.addEventListener("mouseover",(function(){o.style.backgroundColor="rgba(255, 255, 255, 0.2)",o.style.borderColor="rgba(255, 255, 255, 0.4)",o.style.transform="translateY(-2px)"})),o.addEventListener("mouseout",(function(){o.style.backgroundColor="rgba(255, 255, 255, 0.1)",o.style.borderColor="rgba(255, 255, 255, 0.2)",o.style.transform="translateY(0)"}));var i=document.createElement("div");Object.assign(i.style,{fontWeight:"bold",fontSize:"16px",marginBottom:"12px",borderBottom:"1px solid rgba(255,255,255,0.2)",paddingBottom:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"});var a=document.createElement("span");a.textContent="Video Summary (Loading...)";var c=document.createElement("button");c.textContent="Ã—",Object.assign(c.style,{background:"none",border:"none",color:"white",fontSize:"20px",cursor:"pointer",padding:"0 8px",marginLeft:"auto"}),c.addEventListener("click",(function(){e.style.display="none"})),i.appendChild(a),i.appendChild(c);var s=document.createElement("div");return s.id="chat-box-summary-content",e.appendChild(i),e.appendChild(s),e.appendChild(t),{container:e,title:a,content:s}}function L(e,t){return M.apply(this,arguments)}function M(){return M=l(n().mark((function e(r,o){var i,a,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,i='You are a highly skilled AI assistant tasked with summarizing YouTube video content.\n\nHere is the information about the video:\nTranscript: "'.concat(r.transcript,'"\nTitle: ').concat(r.title,"\nChannel: ").concat(r.channel||"Unknown","\n").concat(r.description?"Description: ".concat(r.description,"\n"):"","\nPlease use the provided transcript to generate the summary.\n\nFor each video, provide a structured summary with two sections: [Summary] and [Highlights].\n\n[Summary]: Summarize the main content, theme, and purpose of the video in 2-3 concise sentences. Focus on the core message and intent without including unnecessary details.\n\n[Highlights]: List 5-8 key points or notable moments from the video in bullet points. Each point should be brief, specific, and capture essential information, insights, or moments worth noting.\n\nUse a clear, neutral, and professional tone. Ensure the output is engaging and easy to read, tailored to someone who wants a quick yet comprehensive overview of the video."),a=null;try{(c=localStorage.getItem("aiChatSettings"))&&(a=JSON.parse(c))}catch(e){reject("Could not access localStorage, will use chrome.storage.local "+e)}return e.abrupt("return",new Promise((function(e,c){function s(e){return u.apply(this,arguments)}function u(){return(u=l(n().mark((function a(s){var l,u,d,p,f,h,m,g,b,y,v,w,x,k,C,E,S,T,j,O,P,I,L,M,z,_,N,B,$,F,H,Y,q,R,D;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=s.selectedModel||"gpt-3.5-turbo",u="",d="",p=l,f=null,s.providers&&Array.isArray(s.providers)?(f=s.providers.find((function(e){return e.models&&Array.isArray(e.models)&&e.models.includes(l)})))?(u=f.apiKey,d=f.endpoint):(h=s.providers.find((function(e){return!0===e.selectedProvider})))&&(u=h.apiKey,d=h.endpoint,h.models&&!h.models.includes(l)&&console.warn("Warning: Model ".concat(l," not found in provider ").concat(h.name,"'s models list"))):c("Using legacy settings format (no providers array"),!u&&s.apiKey&&(u=s.apiKey),!d&&s.endpoint&&(d=s.endpoint),d||(d="https://api.openai.com/v1"),u){n.next=12;break}return c("API key not configured. Please set up your API key in the extension settings."),n.abrupt("return");case 12:return n.prev=12,m=d.endsWith("/")?"".concat(d,"chat/completions"):"".concat(d,"/chat/completions"),g={model:p,messages:[{role:"system",content:i},{role:"user",content:"Summarize this YouTube video: ".concat(r.title)}],max_tokens:800,temperature:.7,stream:!0},o&&(o.title.textContent="Video Summary (Streaming...)",o.content.innerHTML=A("Loading summary...")),n.next=18,fetch(m,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u)},body:JSON.stringify(g)});case 18:if((b=n.sent).ok){n.next=26;break}return n.next=22,b.json();case 22:return v=n.sent,w=(null===(y=v.error)||void 0===y?void 0:y.message)||"Error ".concat(b.status,": ").concat(b.statusText),c(w),n.abrupt("return");case 26:x=b.body.getReader(),k=new TextDecoder("utf-8"),C="",E="";case 30:return n.next=33,x.read();case 33:if(S=n.sent,T=S.done,j=S.value,!T){n.next=38;break}return n.abrupt("break",63);case 38:E+=k.decode(j,{stream:!0}),O=E.split("\n"),E=O.pop()||"",P=t(O),n.prev=42,P.s();case 44:if((I=P.n()).done){n.next=53;break}if(""!==(L=I.value).trim()){n.next=48;break}return n.abrupt("continue",51);case 48:if("data: [DONE]"!==L.trim()){n.next=50;break}return n.abrupt("continue",51);case 50:try{L.startsWith("data: ")&&(z=JSON.parse(L.substring(6)),(_=(null===(M=z.choices)||void 0===M||null===(M=M[0])||void 0===M||null===(M=M.delta)||void 0===M?void 0:M.content)||"")&&(C+=_,o&&(o.content.innerHTML=A(C))))}catch(e){console.warn("Error parsing stream line:",e,L)}case 51:n.next=44;break;case 53:n.next=58;break;case 55:n.prev=55,n.t0=n.catch(42),P.e(n.t0);case 58:return n.prev=58,P.f(),n.finish(58);case 61:n.next=30;break;case 63:if((N=k.decode())&&(E+=N),!E){n.next=91;break}n.prev=66,B=E.split("\n"),$=t(B),n.prev=69,$.s();case 71:if((F=$.n()).done){n.next=78;break}if(""!==(H=F.value).trim()&&"data: [DONE]"!==H.trim()){n.next=75;break}return n.abrupt("continue",76);case 75:H.startsWith("data: ")&&(q=JSON.parse(H.substring(6)),(R=(null===(Y=q.choices)||void 0===Y||null===(Y=Y[0])||void 0===Y||null===(Y=Y.delta)||void 0===Y?void 0:Y.content)||"")&&(C+=R));case 76:n.next=71;break;case 78:n.next=83;break;case 80:n.prev=80,n.t1=n.catch(69),$.e(n.t1);case 83:return n.prev=83,$.f(),n.finish(83);case 86:n.next=91;break;case 88:n.prev=88,n.t2=n.catch(66),console.warn("Error parsing final buffer:",n.t2);case 91:o&&(o.title.textContent="Summary "+r.title.substring(0,30)+"...",o.content.innerHTML=A(C),(D=document.getElementById("video-summary-actions"))&&(D.style.display="flex")),e(C||"No summary generated"),n.next=99;break;case 95:n.prev=95,n.t3=n.catch(12),console.error("Error in streaming request:",n.t3),c("Error generating summary: ".concat(n.t3.message));case 99:case"end":return n.stop()}}),a,null,[[12,95],[42,55,58,61],[66,88],[69,80,83,86]])})))).apply(this,arguments)}a?s(a):chrome.storage.local.get(["aiChatSettings"],function(){var e=l(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.aiChatSettings){e.next=3;break}return c("API settings not configured. Please set up your API settings in the extension settings."),e.abrupt("return");case 3:s(t.aiChatSettings);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})));case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error in fetchVideoSummary:",e.t0),e.abrupt("return","Error generating summary: ".concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),M.apply(this,arguments)}function A(e){if(!e)return"";if(!document.getElementById("markdown-styles")){var t=document.createElement("style");t.id="markdown-styles",t.textContent="\n    .markdown-content { color: #e4e4e7; font-size: 15px; line-height: 1.6;}\n    .markdown-content h1 { font-size: 1.5rem; font-weight: bold; margin: 1.2rem 0 0.8rem; color: white; }\n    .markdown-content h2 { font-size: 1.25rem; font-weight: bold; margin: 1rem 0 0.7rem; color: white; }\n    .markdown-content h3 { font-size: 1.1rem; font-weight: bold; margin: 0.8rem 0 0.5rem; color: white; }\n    .markdown-content p { margin: 0.7rem 0; }\n    .markdown-content ul { padding-left: 1.5rem; margin: 0.7rem 0; list-style-type: disc; }\n    .markdown-content ol { padding-left: 1.5rem; margin: 0.7rem 0; list-style-type: decimal; }\n    .markdown-content li { margin: 0.4rem 0; padding-left: 0.3rem; }\n    .markdown-content li::marker { color: #737373; }\n    .markdown-content code { background-color: rgba(255, 255, 255, 0.1); padding: 0.1rem 0.3rem; border-radius: 3px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 0.9em; }\n    .markdown-content strong { font-weight: bold; color: white; }\n    .markdown-content em { font-style: italic; }\n    .markdown-content a { color: #3b82f6; text-decoration: underline; }\n    .markdown-content a:hover { text-decoration: none; }\n    .markdown-content blockquote { border-left: 3px solid #3b82f6; padding: 0.5rem 0 0.5rem 1rem; margin: 0.8rem 0; color: rgba(255, 255, 255, 0.7); background-color: rgba(59, 130, 246, 0.05); }\n    .markdown-code-block { position: relative; margin: 1rem 0; overflow: hidden; }\n    .markdown-code-content { overflow-x: auto; overflow-y: hidden; scrollbar-width: none; }\n    .copy-button { background: rgba(255, 255, 255, 0.1); border: none; border-radius: 4px; color: #e4e4e7; cursor: pointer; padding: 4px 8px; font-size: 12px; transition: background-color 0.2s; }\n    .copy-button:hover { background: rgba(255, 255, 255, 0.2); }\n    .copy-button.copied { background: rgba(16, 185, 129, 0.2); color: #10b981; }\n    .markdown-content table { border-collapse: collapse; width: 100%; margin: 1rem 0; }\n    .markdown-content th { background-color: rgba(255, 255, 255, 0.1); padding: 0.5rem; text-align: left; font-weight: bold; }\n    .markdown-content td { padding: 0.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1); }\n    .markdown-content tr:nth-child(even) { background-color: rgba(255, 255, 255, 0.05); }\n    .markdown-hr { border: 0; height: 1px; background: rgba(255, 255, 255, 0.2); margin: 1.5rem 0; }\n    .summary-highlight-heading {font-size: 2rem; font-weight: bold; color: hsl(249, 40%, 54%); margin: 2rem 0 1rem 0; }\n    /* AI Thinking styles */\n    .ai-thinking-container { margin: 1rem 0; border: 1px solid #3b4351; border-radius: 6px; overflow: hidden; }\n    .ai-thinking-header { display: flex; align-items: center; justify-content: space-between; padding: 0.7rem 1rem; background-color: #353940; cursor: pointer; }\n    .ai-thinking-title { display: flex; align-items: center; font-size: 0.8rem; font-weight: 600; color: #e4e4e7; }\n    .ai-thinking-title svg { margin-right: 0.5rem; }\n    .ai-thinking-content { padding: 1rem; font-size: 1.4rem; background-color: #1e1e1e; color: #a1a1aa; display: none; border-top: 1px solid #262626; }\n    .ai-thinking-content.show { display: block; }\n  ",document.head.appendChild(t)}var n=!1,r="",o=e,i=e.match(/<think>([\s\S]*?)<\/think>/);i&&(n=!0,r=i[1].trim(),o=e.replace(/<think>[\s\S]*?<\/think>/g,"").trim());var a=function(e){return e.replace(/```([\s\S]*?)```/g,(function(e,t){var n=t.replace(/</g,"&lt;").replace(/>/g,"&gt;");return'<div class="markdown-code-block">\n        <div class="markdown-code-content"><div>'.concat(n,"</div></div>\n      </div>")})).replace(/\|([^\n]*?)\|\n\|\s*:?-+:?\s*\|[^\n]*?\n([\s\S]*?)(?=\n\n|$)/g,(function(e,t,n){var r=t.split("|").map((function(e){return e.trim()})).filter(Boolean).map((function(e){return"<th>".concat(e,"</th>")})).join(""),o=n.split("\n").filter((function(e){return e.trim()&&e.includes("|")})).map((function(e){var t=e.split("|").map((function(e){return e.trim()})).filter(Boolean);return"<tr>".concat(t.map((function(e){return"<td>".concat(e,"</td>")})).join(""),"</tr>")})).join("");return"<table>\n        <thead><tr>".concat(r,"</tr></thead>\n        <tbody>").concat(o,"</tbody>\n      </table>")})).replace(/^---+$/gm,'<hr class="markdown-hr">').replace(/^### (.*$)/gm,"<h3>$1</h3>").replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/^\* (.*$)/gm,"<li>$1</li>").replace(/^- (.*$)/gm,"<li>$1</li>").replace(/^\d+\. (.*$)/gm,"<li>$1</li>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>').replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>").replace(/<\/li><br><li>/g,"</li><li>").replace(/<br><li>/g,"<ul><li>").replace(/<\/li><br>/g,"</li></ul>").replace(/<\/li>(?!<\/ul>)/g,"</li></ul>").replace(/<ul><\/ul>/g,"")},c=a(o),s=n?a(r):"";c=(c=c.replace(/\[(Summary|Highlights)\]/g,'<strong class="summary-highlight-heading">[$1]</strong>')).replace(/<h3>\s*<strong>(Summary|Highlights)<\/strong>\s*<\/h3>/g,'<h3><strong class="summary-highlight-heading">$1</strong></h3>');var l="";if(n){var u="thinking-".concat(Date.now());l+='\n      <div class="ai-thinking-container">\n        <div class="ai-thinking-header" onclick="document.getElementById(\''.concat(u,'\').classList.toggle(\'show\')">\n          <div class="ai-thinking-title" style="font-size: 12px;">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>\n            AI Thinking Process\n          </div>\n          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>\n        </div>\n        <div id="').concat(u,'" class="ai-thinking-content">\n          ').concat(s,"\n        </div>\n      </div>\n    ")}return'<div class="markdown-content">'.concat(l+=c,"</div>")}function z(e){return new Promise((function(t){var n=document.querySelector(e);if(n)return t(n);var r=new MutationObserver((function(){var n=document.querySelector(e);n&&(t(n),r.disconnect())}));r.observe(document.body,{childList:!0,subtree:!0})}))}function _(){if(!document.getElementById("ai-chat-sidebar-button")){var e=document.getElementById("actions"),t=document.getElementById("top-level-buttons-computed");if(e||t){var r=document.createElement("button");r.id="ai-chat-sidebar-button",r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0,0,256,256">\n<g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(5.12,5.12)"><path d="M49.726,25.312l-18,-19c-0.003,-0.003 -0.007,-0.004 -0.01,-0.007c-0.074,-0.076 -0.165,-0.133 -0.26,-0.182c-0.022,-0.011 -0.038,-0.031 -0.061,-0.041c-0.074,-0.032 -0.158,-0.038 -0.24,-0.051c-0.05,-0.008 -0.095,-0.031 -0.146,-0.031c-0.001,0 -0.003,0.001 -0.005,0.001c-0.001,0 -0.003,-0.001 -0.004,-0.001h-11.852c-0.026,0 -0.048,0.013 -0.074,0.015c-0.025,-0.002 -0.048,-0.015 -0.074,-0.015c-0.002,0 -0.005,0 -0.007,0c-0.272,0.002 -0.532,0.114 -0.719,0.312l-17.98,18.98c-0.001,0.001 -0.001,0.001 -0.002,0.002l-0.017,0.018c-0.038,0.041 -0.056,0.091 -0.086,0.136c-0.039,0.058 -0.085,0.11 -0.112,0.176c-0.098,0.241 -0.098,0.51 0,0.751c0.027,0.066 0.073,0.118 0.112,0.176c0.03,0.045 0.048,0.095 0.086,0.136l0.017,0.018c0.001,0.001 0.001,0.001 0.002,0.002l17.98,18.979c0.188,0.2 0.451,0.354 0.726,0.312c0.026,0 0.049,-0.013 0.074,-0.015c0.026,0.004 0.048,0.017 0.074,0.017h11.632c0.039,0 0.072,-0.018 0.11,-0.022c0.038,0.004 0.072,0.022 0.11,0.022c0.002,0 0.005,0 0.007,0c0.272,-0.002 0.532,-0.114 0.719,-0.312l18,-19c0.366,-0.386 0.366,-0.99 0,-1.376zM46.675,25h-8.725l-11.575,-11.869l4.611,-4.69zM36.023,25.888c-0.003,0.029 -0.016,0.054 -0.017,0.083l-11.033,11.412l-11.172,-11.462l11.172,-11.364zM28.615,8l-3.636,3.698l-3.607,-3.698zM19.011,8.443l4.565,4.682l-11.674,11.875h-8.577zM19.008,43.554l-15.683,-16.554h8.675c0.018,0 0.032,-0.009 0.05,-0.01l11.532,11.832zM21.358,44l3.621,-3.745l3.65,3.745zM30.99,43.557l-4.621,-4.741l11.424,-11.816h8.882z"></path></g></g>\n</svg> Summary',Object.assign(r.style,{backgroundColor:"#373762",color:"white",border:"none",borderRadius:"20px",padding:"9px",margin:"0 4px",cursor:"pointer",fontFamily:"Roboto, Arial, sans-serif",fontSize:"14px",fontWeight:"500",transition:"background-color 0.2s, transform 0.2s",width:"120px",alignItems:"center",display:"flex",justifyContent:"center",gap:"8px"}),r.addEventListener("mouseover",(function(){r.style.transform="translateY(-2px)",r.style.boxShadow="0px 4px 8px rgba(0, 0, 0, 0.1)",r.style.backgroundColor="hsl(249, 50%, 70%)"})),r.addEventListener("mouseout",(function(){r.style.transform="translateY(0)",r.style.boxShadow="none",r.style.backgroundColor="hsl(249, 50%, 60%)"})),r.addEventListener("click",l(n().mark((function e(){var t,r,o,i,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("chat-box-video-summary")){e.next=4;break}return console.error("AI Chat: Summary container not found."),e.abrupt("return");case 4:if(r="none"===t.style.display,t.style.display=r?"block":"none",!r||t.dataset.summaryFetched){e.next=12;break}return t.dataset.summaryFetched="true",e.next=10,N();case 10:if(o=e.sent){try{sessionStorage.setItem("youtubeVideoContext",JSON.stringify(o))}catch(e){console.error("Failed to store YouTube context:",e)}i=t.querySelector("span"),a=t.querySelector("#chat-box-summary-content"),i&&a&&(i.textContent="Summarizing: ".concat(o.title.substring(0,50)).concat(o.title.length>50?"...":""),a.textContent="Generating video summary...",L(o,{title:i,content:a}).then((function(){return console.log("Summary generation completed successfully")})).catch((function(e){a.textContent="Error: ".concat(e)})))}case 12:case"end":return e.stop()}}),e)})))),e.appendChild(r)}}}function N(){return B.apply(this,arguments)}function B(){return(B=l(n().mark((function e(){var t,r,o,i,a,c,s,l,u,d,p,f,h,m,g,b,y,v,w;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($()){e.next=2;break}return e.abrupt("return",null);case 2:e.prev=2,n=void 0,n=new URLSearchParams(window.location.search),t=n.get("v"),r=document.title.replace(" - YouTube",""),o="",(i=document.querySelector("#description-inline-expander, #description-text"))&&(o=i.textContent.trim()),a="",(c=document.querySelector("#channel-name a, #text-container.ytd-channel-name a"))&&(a=c.textContent.trim()),s="",(l=document.querySelector("#info-text"))&&(s=l.textContent.trim()),u="",d=null,p=0,f=["#segments-container ytd-transcript-segment-renderer yt-formatted-string.segment-text",'ytd-engagement-panel-section-list-renderer[target-id="engagement-panel-searchable-transcript"] ytd-transcript-segment-renderer yt-formatted-string.segment-text',"ytd-transcript-renderer #content ytd-transcript-body-renderer yt-formatted-string.segment-text","ytd-transcript-segment-renderer yt-formatted-string","ytd-transcript-segment-renderer .yt-core-attributed-string",".ytp-caption-segment",'div[aria-label^="Transcript segment"] .yt-core-attributed-string','button[aria-label^="Transcript segment"] .yt-core-attributed-string',".ytd-transcript-body-renderer .cue","#transcript-text .cue","ytd-transcript-body-renderer div.cue-group div.cue",".transcript-text-segment"];case 19:if(!(p<f.length)){e.next=27;break}if(h=f[p],!((d=document.querySelectorAll(h))&&d.length>0)){e.next=24;break}return e.abrupt("break",27);case 24:p++,e.next=19;break;case 27:if(d&&d.length>0&&(m=[],d.forEach((function(e){var t=(e.textContent||e.innerText||"").trim();if(!t){var n=e.closest('div.segment[role="button"]');if(n){var r=n.getAttribute("aria-label");if(r){var o="",i=r.match(/^(?:(?:\d{1,2}:)?\d{1,2}:)?\d{1,2}\s+(.*)$/),a=r.match(/^\d+\s+seconds?\s+(.*)$/i);i&&i[1]?o=i[1].trim():a&&a[1]&&(o=a[1].trim()),o&&(t=o)}}}t&&m.push(t)})),u=m.join(" ").replace(/\s+/g," ").trim()),u&&!(u.length<50)){e.next=68;break}return e.prev=30,g=document.documentElement.lang||navigator.language.split("-")[0]||"en",b=[],e.prev=33,e.next=36,P.fetchTranscript(t,{lang:g});case 36:b=e.sent,e.next=49;break;case 39:if(e.prev=39,e.t0=e.catch(33),console.warn("Failed to fetch transcript in preferred lang ".concat(g,": ").concat(e.t0.message,". Trying default.")),!(e.t0 instanceof O||e.t0 instanceof j)){e.next=48;break}return e.next=45,P.fetchTranscript(t);case 45:b=e.sent,e.next=49;break;case 48:throw e.t0;case 49:b&&b.length>0&&(u=b.map((function(e){return e.text})).join(" ").replace(/\s+/g," ").trim()),e.next=56;break;case 52:e.prev=52,e.t1=e.catch(30),console.error("Error fetching transcript via network:",e.t1.message),e.t1 instanceof T?console.warn("Network fetch: Transcript is disabled for this video."):e.t1 instanceof j&&console.warn("Network fetch: Transcript not available for this video.");case 56:if(u&&!(u.length<50)){e.next=68;break}y=0,v=['ytd-menu-service-item-renderer button[aria-label="Show transcript"]','button[aria-label*="Show transcript" i]','button[title*="transcript" i]','#description-box button[aria-label*="transcript" i]',"ytd-video-description-transcript-section-renderer button"];case 60:if(!(y<v.length)){e.next=68;break}if(w=v[y],!document.querySelector(w)){e.next=65;break}return e.abrupt("break",68);case 65:y++,e.next=60;break;case 68:return e.abrupt("return",{type:"youtube",videoId:t,title:r,description:o,channel:a,stats:s,transcript:u,url:window.location.href});case 71:return e.prev=71,e.t2=e.catch(2),console.error("Error extracting YouTube info:",e.t2),e.abrupt("return",null);case 75:case"end":return e.stop()}var n}),e,null,[[2,71],[30,52],[33,39]])})))).apply(this,arguments)}function $(){return window.location.hostname.includes("youtube.com")&&window.location.pathname.includes("/watch")&&window.location.href.includes("v=")}function F(){return H.apply(this,arguments)}function H(){return(H=l(n().mark((function e(){var t,r,o,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("ai-chat-sidebar-button"),r=document.getElementById("chat-box-video-summary"),!$()){e.next=11;break}if(r){e.next=8;break}return e.next=6,z("#secondary-inner");case 6:(o=e.sent)&&(i=I(),o.firstChild?o.insertBefore(i.container,o.firstChild):o.appendChild(i.container));case 8:t||_(),e.next=13;break;case 11:t&&t.remove(),r&&r.remove();case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y=new MutationObserver((function(){F()}));window.location.hostname.includes("youtube.com")&&(F(),window.addEventListener("yt-navigate-finish",F),Y.observe(document.body,{childList:!0,subtree:!0})),chrome.runtime.onMessage.addListener((function(e,t,n){if("getPageContent"===e.action)if($())N().then((function(e){n(a(a({},e),{},{title:document.title,url:window.location.href}))})).catch((function(e){console.error("Error in getPageContent for YouTube:",e),n({title:document.title,url:window.location.href,error:"Failed to extract YouTube info: "+e.message})}));else{var r=function(){for(var e="",t=0,n=["article","main",".content","#content",".post",".article",".entry-content",'[role="main"]',".main-content"];t<n.length;t++){var r=n[t],o=document.querySelectorAll(r);if(o&&o.length>0){o.forEach((function(t){e+=t.innerText+"\n\n"}));break}}if(!e.trim()){for(var i,a=[],c=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:function(e){if(e.parentElement){var t=window.getComputedStyle(e.parentElement),n="none"===t.display||"hidden"===t.visibility||"0"===t.opacity,r="SCRIPT"===e.parentElement.tagName||"STYLE"===e.parentElement.tagName;if(n||r)return NodeFilter.FILTER_REJECT;if(e.textContent.trim().length>20)return NodeFilter.FILTER_ACCEPT}return NodeFilter.FILTER_SKIP}});i=c.nextNode();)a.push(i.textContent.trim());e=a.join("\n\n")}var s=15e3;return(e=e.replace(/\s+/g," ").replace(/\n\s*\n/g,"\n\n").trim()).length>s&&(e=e.substring(0,s)+"\n\n[Content truncated due to length. Extracted first "+s+" characters]"),e||document.body.innerText.substring(0,s)}();n({title:document.title,url:window.location.href,content:r})}return!0}))})();