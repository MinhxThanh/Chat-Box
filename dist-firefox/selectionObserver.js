/*! For license information please see selectionObserver.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,i=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw i}}}}function n(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(){"use strict";o=function(){return n};var t,n={},r=Object.prototype,a=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n,r){return Object.defineProperty(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r})}try{u({},"")}catch(t){u=function(e,t,n){return e[t]=n}}function d(e,n,r,o){var a=n&&n.prototype instanceof m?n:m,i=Object.create(a.prototype);return u(i,"_invoke",function(e,n,r){var o=1;return function(a,i){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===a)throw i;return{value:t,done:!0}}for(r.method=a,r.arg=i;;){var c=r.delegate;if(c){var l=E(c,r);if(l){if(l===h)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===o)throw o=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=3;var s=p(e,n,r);if("normal"===s.type){if(o=r.done?4:2,s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=4,r.method="throw",r.arg=s.arg)}}}(e,r,new q(o||[])),!0),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=d;var h={};function m(){}function f(){}function v(){}var g={};u(g,c,(function(){return this}));var b=Object.getPrototypeOf,y=b&&b(b(C([])));y&&y!==r&&a.call(y,c)&&(g=y);var w=v.prototype=m.prototype=Object.create(g);function x(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(t,n){function r(o,i,c,l){var s=p(t[o],t,i);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==e(d)&&a.call(d,"__await")?n.resolve(d.__await).then((function(e){r("next",e,c,l)}),(function(e){r("throw",e,c,l)})):n.resolve(d).then((function(e){u.value=e,c(u)}),(function(e){return r("throw",e,c,l)}))}l(s.arg)}var o;u(this,"_invoke",(function(e,t){function a(){return new n((function(n,o){r(e,t,n,o)}))}return o=o?o.then(a,a):a()}),!0)}function E(e,n){var r=n.method,o=e.i[r];if(o===t)return n.delegate=null,"throw"===r&&e.i.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=p(o,e.i,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,h;var i=a.arg;return i?i.done?(n[e.r]=i.value,n.next=e.n,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function S(e){this.tryEntries.push(e)}function L(e){var n=e[4]||{};n.type="normal",n.arg=t,e[4]=n}function q(e){this.tryEntries=[[-1]],e.forEach(S,this),this.reset(!0)}function C(n){if(null!=n){var r=n[c];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var o=-1,i=function e(){for(;++o<n.length;)if(a.call(n,o))return e.value=n[o],e.done=!1,e;return e.value=t,e.done=!0,e};return i.next=i}}throw new TypeError(e(n)+" is not iterable")}return f.prototype=v,u(w,"constructor",v),u(v,"constructor",f),f.displayName=u(v,s,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},n.awrap=function(e){return{__await:e}},x(k.prototype),u(k.prototype,l,(function(){return this})),n.AsyncIterator=k,n.async=function(e,t,r,o,a){void 0===a&&(a=Promise);var i=new k(d(e,t,r,o),a);return n.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(w),u(w,s,"Generator"),u(w,c,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},n.values=C,q.prototype={constructor:q,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(t){i.type="throw",i.arg=e,n.next=t}for(var o=n.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a[4],c=this.prev,l=a[1],s=a[2];if(-1===a[0])return r("end"),!1;if(!l&&!s)throw Error("try statement without catch or finally");if(null!=a[0]&&a[0]<=c){if(c<l)return this.method="next",this.arg=t,r(l),!0;if(c<s)return r(s),!1}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var o=r;break}}o&&("break"===e||"continue"===e)&&o[0]<=t&&t<=o[2]&&(o=null);var a=o?o[4]:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o[2],h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[2]===e)return this.complete(n[4],n[3]),L(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[0]===e){var r=n[4];if("throw"===r.type){var o=r.arg;L(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={i:C(e),r:n,n:r},"next"===this.method&&(this.arg=t),h}},n}function a(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function c(e){a(i,r,o,c,l,"next",e)}function l(e){a(i,r,o,c,l,"throw",e)}c(void 0)}))}}!function(){var e=null,r=null,a="",c={},l=null,s="English",u=null,d=[],p=[],h=0,m=null,f=["English","Spanish","Mandarin Chinese","Hindi","French","Arabic","Bengali","Russian","Portuguese","Indonesian","German","Japanese","Swahili","Korean","Italian","Turkish","Dutch","Polish","Thai","Vietnamese"],v=[{action:"summarize",title:"Summarize",icon:"assets/action-icons/summarize.svg"},{action:"explain",title:"Explain",icon:"assets/action-icons/explain.svg"},{action:"translate",title:"Translate",icon:"assets/action-icons/translate.svg"},{action:"rewrite",title:"Rewrite",icon:"assets/action-icons/rewrite.svg"},{action:"grammar",title:"Fix Grammar",icon:"assets/action-icons/grammar.svg"}];function g(t,n){if(!e){(e=document.createElement("div")).className="chatbox-selection-dot",e.title="Cmd + E to open Chat Box",e.innerHTML='\n        <button id="chatbox-button-icon" class="chatbox-button-icon">\n          <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="250" height="250" viewBox="0,0,256,256">\n            <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">\n              <g transform="scale(5.12,5.12)">\n                <path d="M49.726,25.312l-18,-19c-0.003,-0.003 -0.007,-0.004 -0.01,-0.007c-0.074,-0.076 -0.165,-0.133 -0.26,-0.182c-0.022,-0.011 -0.038,-0.031 -0.061,-0.041c-0.074,-0.032 -0.158,-0.038 -0.24,-0.051c-0.05,-0.008 -0.095,-0.031 -0.146,-0.031c-0.001,0 -0.003,0.001 -0.005,0.001c-0.001,0 -0.003,-0.001 -0.004,-0.001h-11.852c-0.026,0 -0.048,0.013 -0.074,0.015c-0.025,-0.002 -0.048,-0.015 -0.074,-0.015c-0.002,0 -0.005,0 -0.007,0c-0.272,0.002 -0.532,0.114 -0.719,0.312l-17.98,18.98c-0.001,0.001 -0.001,0.001 -0.002,0.002l-0.017,0.018c-0.038,0.041 -0.056,0.091 -0.086,0.136c-0.039,0.058 -0.085,0.11 -0.112,0.176c-0.098,0.241 -0.098,0.51 0,0.751c0.027,0.066 0.073,0.118 0.112,0.176c0.03,0.045 0.048,0.095 0.086,0.136l0.017,0.018c0.001,0.001 0.001,0.001 0.002,0.002l17.98,18.979c0.188,0.2 0.451,0.354 0.726,0.312c0.026,0 0.049,-0.013 0.074,-0.015c0.026,0.004 0.048,0.017 0.074,0.017h11.632c0.039,0 0.072,-0.018 0.11,-0.022c0.038,0.004 0.072,0.022 0.11,0.022c0.002,0 0.005,0 0.007,0c0.272,-0.002 0.532,-0.114 0.719,-0.312l18,-19c0.366,-0.386 0.366,-0.99 0,-1.376zM46.675,25h-8.725l-11.575,-11.869l4.611,-4.69zM36.023,25.888c-0.003,0.029 -0.016,0.054 -0.017,0.083l-11.033,11.412l-11.172,-11.462l11.172,-11.364zM28.615,8l-3.636,3.698l-3.607,-3.698zM19.011,8.443l4.565,4.682l-11.674,11.875h-8.577zM19.008,43.554l-15.683,-16.554h8.675c0.018,0 0.032,-0.009 0.05,-0.01l11.532,11.832zM21.358,44l3.621,-3.745l3.65,3.745zM30.99,43.557l-4.621,-4.741l11.424,-11.816h8.882z"></path>\n              </g>\n            </g>\n          </svg>\n        </button>\n      ';var r=document.createElement("div");r.className="chatbox-selection-nav",e.appendChild(r),document.body.appendChild(e),v.forEach((function(e){var t=e.action,n=e.title,o=e.icon,a=document.createElement("div");a.className="chatbox-nav-button",a.dataset.action=t,a.title=n;var i=document.createElement("img");i.src=chrome.runtime.getURL(o),a.appendChild(i),r.appendChild(a)})),e.querySelectorAll(".chatbox-nav-button").forEach((function(e){e.addEventListener("click",(function(t){t.stopPropagation(),function(e){x.apply(this,arguments)}(e.getAttribute("data-action"))}))})),e.addEventListener("click",(function(e){e.target.closest(".chatbox-nav-button")||(chrome.runtime.sendMessage({action:"openSidebar"}),q())}))}e.style.left="".concat(t-10,"px"),e.style.top="".concat(n-44,"px"),e.style.display="block"}function b(e,t){if(z()){d=[],a=t,p=[{id:0,label:"Initial",content:"",timestamp:Date.now()}],h=0,r||t&&t.trim().length>0&&((r=document.createElement("div")).className="chatbox-base-quick-panel",document.body.appendChild(r)),r.innerHTML='\n      <div class="quick-panel-header">\n        <span>'.concat(e.charAt(0).toUpperCase()+e.slice(1),'</span>\n\n        <div class="quick-panel-header-right">\n        ').concat("translate"===e?'\n         <div class="language-selector-container '.concat("translate"===e?"active":"",'">\n          <label class="language-selector-label">Target Language:</label>\n          <div class="language-selector">\n            <button class="language-selector-button" type="button">\n              <span class="selected-language">').concat(s,'</span>\n              <svg class="language-dropdown-arrow" fill="currentColor" width="12" height="12" viewBox="0 0 12 12">\n                <path fill-rule="evenodd" d="M1.167 3.655a.47.47 0 0 1 .663-.004l3.84 3.8c.183.182.477.182.66 0l3.84-3.8a.469.469 0 1 1 .66.667l-3.84 3.8a1.406 1.406 0 0 1-1.98 0l-3.84-3.8a.47.47 0 0 1-.003-.663" clip-rule="evenodd"></path>\n              </svg>\n            </button>\n            <div class="language-dropdown-menu">\n              ').concat(f.map((function(e){return'\n                <div class="language-option '.concat(e===s?"selected":"",'" data-language="').concat(e,'">\n                  ').concat(e,"\n                </div>\n              ")})).join(""),"\n            </div>\n          </div>\n        </div>\n        "):"",'\n        <button class="quick-panel-close">&times;</button>\n      </div>\n      </div>\n      <div class="quick-panel-content">\n        <div class="selected-text-display">\n          <div class="wrapper">\n            <div class="content">').concat(t,'</div>\n          </div>\n          <div class="collapse-btn">\n            <span class="arrow-icon">\n              <svg fill="currentColor" width="12" height="12" viewBox="0 0 12 12">\n                <path fill-rule="evenodd" d="M1.167 3.655a.47.47 0 0 1 .663-.004l3.84 3.8c.183.182.477.182.66 0l3.84-3.8a.469.469 0 1 1 .66.667l-3.84 3.8a1.406 1.406 0 0 1-1.98 0l-3.84-3.8a.47.47 0 0 1-.003-.663" clip-rule="evenodd"></path>\n              </svg>\n            </span>\n          </div>\n        </div>\n        <div class="response-tabs-container">\n          <div class="response-tabs-header">\n            <div class="response-tabs"></div>\n            <div class="tab-navigation">\n              <button class="tab-nav-btn" id="prev-tab" title="Previous response" disabled>\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                  <polyline points="15,18 9,12 15,6"></polyline>\n                </svg>\n              </button>\n              <button class="tab-nav-btn" id="next-tab" title="Next response" disabled>\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                  <polyline points="9,18 15,12 9,6"></polyline>\n                </svg>\n              </button>\n            </div>\n          </div>\n          <div class="response-tabs-content">\n            <div class="tab-content active" data-tab="0">\n              <div class="action-result">\n               \n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="quick-panel-footer">\n          <div class="quick-panel-toolbar">\n           <div class="continue-chat-section">            \n             <span class="chat-input-text" title="What would you like to know?">What would you like to know?</span>\n             <div class="enter-icon">\n               <svg width="10" height="10" fill="none" viewBox="0 0 17 16">\n                 <path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 2.625a.625.625 0 0 0-1.25 0v5.938c0 .345-.28.624-.625.624H4.134l2.495-2.495a.625.625 0 0 0-.883-.884L3.067 8.487a1.875 1.875 0 0 0 0 2.651l2.679 2.679a.625.625 0 1 0 .883-.884l-2.495-2.495h8.491c1.036 0 1.875-.84 1.875-1.876V2.625Z" fill="currentColor"/>\n               </svg>\n             </div>\n           </div>\n\n           <div class="continue-chat-input">\n             <input type="text" placeholder="What would you like to know?" />\n             <div class="continue-input-actions">\n               <button class="input-action-btn" title="Send" data-action="send">\n                 <svg width="10" height="10" fill="none" viewBox="0 0 17 16">\n                   <path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 2.625a.625.625 0 0 0-1.25 0v5.938c0 .345-.28.624-.625.624H4.134l2.495-2.495a.625.625 0 0 0-.883-.884L3.067 8.487a1.875 1.875 0 0 0 0 2.651l2.679 2.679a.625.625 0 1 0 .883-.884l-2.495-2.495h8.491c1.036 0 1.875-.84 1.875-1.876V2.625Z" fill="currentColor"/>\n                 </svg>\n               </button>\n               <button class="input-action-btn" title="Cancel" data-action="cancel">\n                 <svg width="10" height="10" fill="none" viewBox="0 0 16 16">\n                   <path fill-rule="evenodd" clip-rule="evenodd" d="M12.6569 3.34315C12.2663 2.95262 11.6332 2.95262 11.2426 3.34315L8 6.58579L4.75736 3.34315C4.36683 2.95262 3.73367 2.95262 3.34314 3.34315C2.95262 3.73367 2.95262 4.36683 3.34314 4.75736L6.58579 8L3.34314 11.2426C2.95262 11.6332 2.95262 12.2663 3.34314 12.6569C3.73367 13.0474 4.36683 13.0474 4.75736 12.6569L8 9.41421L11.2426 12.6569C11.6332 13.0474 12.2663 13.0474 12.6569 12.6569C13.0474 12.2663 13.0474 11.6332 12.6569 11.2426L9.41421 8L12.6569 4.75736C13.0474 4.36683 13.0474 3.73367 12.6569 3.34315Z" fill="currentColor"/>\n                 </svg>\n               </button>\n             </div>\n           </div>\n         \n           \n           <div class="divider"></div>\n           \n           <div class="toolbar-actions">\n            <button class="icon-btn" title="Copy">\n              <svg width="16" height="16" fill="none" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" clip-rule="evenodd" d="M6.125 2C5.089 2 4.25 2.84 4.25 3.875v.375h-.375C2.839 4.25 2 5.09 2 6.125v6C2 13.161 2.84 14 3.875 14h6c1.036 0 1.875-.84 1.875-1.875v-.375h.375c1.036 0 1.875-.84 1.875-1.875v-6C14 2.839 13.16 2 12.125 2h-6Zm5.625 8.5h.375c.345 0 .625-.28.625-.625v-6a.625.625 0 0 0-.625-.625h-6a.625.625 0 0 0-.625.625v.375h4.375c1.036 0 1.875.84 1.875 1.875V10.5Zm-8.5-4.375c0-.345.28-.625.625-.625h6c.345 0 .625.28.625.625v6c0 .345-.28.625-.625.625h-6a.625.625 0 0 1-.625-.625v-6Z" fill="currentColor"/>\n              </svg>\n            </button>\n            \n            <button class="icon-btn" title="Regenerate">\n              <svg width="16" height="16" fill="none" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" clip-rule="evenodd" d="M13.688 2.313a.625.625 0 0 0-.626.624v1.5h-1.5a.625.625 0 1 0 0 1.25h2.126c.345 0 .624-.28.624-.625V2.938a.625.625 0 0 0-.624-.624Z" fill="currentColor"/>\n                <path fill-rule="evenodd" clip-rule="evenodd" d="M13.738 4.686a6.625 6.625 0 1 0 .807 4.348.625.625 0 0 0-1.235-.193A5.377 5.377 0 0 1 2.625 8a5.375 5.375 0 0 1 10.031-2.688.625.625 0 1 0 1.082-.626Z" fill="currentColor"/>\n              </svg>\n            </button>\n          </div>\n          \n          <div class="model-dropdown" data-dropdown="model">\n              <span class="model-dropdown-text">Default Model</span>\n              <svg class="dropdown-arrow" width="10" height="10" fill="none" viewBox="0 0 16 16">\n                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.248 14.444a.625.625 0 0 1-.005-.884l5.068-5.12a.625.625 0 0 0 0-.88L5.243 2.44a.625.625 0 1 1 .889-.88l5.067 5.121c.723.73.723 1.907 0 2.638l-5.067 5.12a.625.625 0 0 1-.884.005Z" fill="currentColor"/>\n              </svg>\n              <div class="model-dropdown-menu">\n                <div class="model-dropdown-header">\n                  <div class="model-dropdown-title">Select AI Model</div>\n                  <input type="text" class="model-search-input" placeholder="Search models..." />\n                </div>\n                <div class="model-dropdown-content">\n                  <div class="no-models-message">Loading models...</div>\n                </div>\n              </div>\n            </div>\n        </div>\n      </div>\n      <div class="quick-panel-resize-handle"></div>\n    '),r.querySelector(".quick-panel-close").addEventListener("click",(function(){m&&(m.abort(),m=null),function(){if(r){r.style.display="none";var e=r.querySelector(".model-dropdown-menu");e&&e.classList.remove("open")}}()})),function(){var e=r.querySelector(".quick-panel-resize-handle");if(e){var t=!1,n=0,o=0;e.addEventListener("mousedown",(function(e){t=!0,n=e.clientY,o=parseInt(document.defaultView.getComputedStyle(r).height,10),document.addEventListener("mousemove",a),document.addEventListener("mouseup",i),document.body.style.userSelect="none",e.preventDefault()}))}function a(e){if(t){var a=e.clientY-n,i=o+a,c=Math.max(379,Math.min(512,i));r.style.height=c+"px"}}function i(){t&&(t=!1,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",i),document.body.style.userSelect="")}}(),r.querySelector(".chat-input-text");var n=r.querySelector(".continue-chat-section"),u=r.querySelector(".continue-chat-input"),v=r.querySelector(".toolbar-actions"),g=r.querySelector(".continue-chat-input input"),b=r.querySelector('.input-action-btn[data-action="send"]'),x=r.querySelector('.input-action-btn[data-action="cancel"]');n.addEventListener("click",(function(){n.style.display="none",u.classList.add("active"),v.classList.add("hidden"),g.focus()})),b.addEventListener("click",i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=g.value.trim())){e.next=4;break}return e.next=4,S(t);case 4:Y();case 5:case"end":return e.stop()}}),e)})))),x.addEventListener("click",Y),g.addEventListener("keydown",function(){var e=i(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key){e.next=9;break}if(t.preventDefault(),!(n=g.value.trim())){e.next=6;break}return e.next=6,S(n);case 6:Y(),e.next=10;break;case 9:"Escape"===t.key&&Y();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var E=r.querySelector('.icon-btn[title="Copy"]');E.addEventListener("click",i(o().mark((function e(){var t,n,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t=p[h])||!t.content){e.next=12;break}return(n=document.createElement("div")).innerHTML=t.content,r=n.textContent||n.innerText||"",e.next=8,navigator.clipboard.writeText(r);case 8:a=E.innerHTML,E.innerHTML='\n            <svg width="16" height="16" fill="none" viewBox="0 0 16 16">\n              <path fill-rule="evenodd" clip-rule="evenodd" d="M13.78 3.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 8.28a.75.75 0 0 1 1.06-1.06L6 10.44l6.72-6.72a.75.75 0 0 1 1.06 0Z" fill="currentColor"/>\n            </svg>\n          ',E.style.color="#10b981",setTimeout((function(){E.innerHTML=a,E.style.color=""}),2e3);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("Failed to copy text:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))),r.querySelector('.icon-btn[title="Regenerate"]').addEventListener("click",i(o().mark((function n(){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k(e,t);case 2:case"end":return n.stop()}}),n)})))),chrome.storage&&chrome.storage.local&&chrome.storage.local.get(["aiChatSettings"],(function(e){if(e.aiChatSettings&&e.aiChatSettings.providers){var t={};e.aiChatSettings.providers.forEach((function(e){e.apiKey&&e.models&&e.models.length>0&&(t[e.name]=e.models)})),c=t,l=e.aiChatSettings.selectedModel||null,y()}})),function(){if(r){var e=r.querySelector('.model-dropdown[data-dropdown="model"]'),t=r.querySelector(".model-dropdown-menu"),n=r.querySelector(".model-search-input");e&&t&&n&&(e.addEventListener("click",(function(e){e.stopPropagation();var r=t.classList.contains("open");document.querySelectorAll(".model-dropdown-menu.open").forEach((function(e){e.classList.remove("open")})),r||(t.classList.add("open"),n.focus())})),n.addEventListener("input",(function(e){w(e.target.value.toLowerCase())})),n.addEventListener("click",(function(e){e.stopPropagation()})),document.addEventListener("click",(function(r){e.contains(r.target)||(t.classList.remove("open"),n.value="",w(""))})))}}();var L=r.querySelector(".selected-text-display"),q=L.querySelector(".content"),C=L.querySelector(".collapse-btn"),T=L.querySelector(".arrow-icon");C.addEventListener("click",(function(){q.classList.contains("expanded")?(q.classList.remove("expanded"),T.classList.remove("rotated")):(q.classList.add("expanded"),T.classList.add("rotated"))})),"translate"===e&&function(){var e,t=null===(e=r)||void 0===e?void 0:e.querySelector(".language-selector");if(t){var n=t.querySelector(".language-selector-button"),a=t.querySelector(".language-dropdown-menu"),c=t.querySelector(".language-dropdown-arrow"),l=t.querySelector(".selected-language");n&&a&&c&&l?(n.addEventListener("click",(function(e){e.stopPropagation(),a.classList.contains("open")?(a.classList.remove("open"),n.classList.remove("open"),c.classList.remove("rotated")):(a.classList.add("open"),n.classList.add("open"),c.classList.add("rotated"))})),a.addEventListener("click",function(){var e=i(o().mark((function e(t){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.target.closest(".language-option")){e.next=3;break}return e.abrupt("return");case 3:return i=r.dataset.language,l.textContent=i,a.querySelectorAll(".language-option").forEach((function(e){e.classList.remove("selected")})),r.classList.add("selected"),e.next=9,M(i);case 9:a.classList.remove("open"),n.classList.remove("open"),c.classList.remove("rotated");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),document.addEventListener("click",(function(e){t.contains(e.target)||(a.classList.remove("open"),n.classList.remove("open"),c.classList.remove("rotated"))}))):console.log("Language selector elements not found")}}(),_=r.querySelector("#prev-tab"),H=r.querySelector("#next-tab"),_&&_.addEventListener("click",(function(){h>0&&R(p[h-1].id)})),H&&H.addEventListener("click",(function(){h<p.length-1&&R(p[h+1].id)})),$();var A=r.querySelector(".replace-btn");A&&A.addEventListener("click",(function(){console.log("Replace clicked")}));var P,N,I,O,j=r.querySelector(".quick-panel-header"),B=!1;j.addEventListener("mousedown",(function(e){B=!0,P=e.clientX,N=e.clientY;var t=r.getBoundingClientRect();I=t.left,O=t.top,r.style.transform="none",r.style.left=I+"px",r.style.top=O+"px",j.style.cursor="grabbing",e.preventDefault()})),document.addEventListener("mousemove",(function(e){if(B){var t=e.clientX-P,n=e.clientY-N;r.style.left=I+t+"px",r.style.top=O+n+"px"}})),document.addEventListener("mouseup",(function(){B&&(B=!1,j.style.cursor="grab")})),r.style.display="flex"}else console.error("Extension context invalidated during showQuickPanel");var _,H;function Y(){n.style.display="flex",u.classList.remove("active"),v.classList.remove("hidden"),g.value=""}}function y(){if(r){var e=r.querySelector(".model-dropdown-text"),t=r.querySelector(".model-dropdown-content");if(e&&t){e.textContent=l||"Default Model";var n="";0===Object.keys(c).length?n='<div class="no-models-message">No models available.<br>Please configure models in settings.</div>':Object.keys(c).forEach((function(e){var t=c[e];t&&t.length>0&&(n+='<div class="model-provider-group">',n+='<div class="model-provider-header">['.concat(e,"]</div>"),t.forEach((function(e){n+='\n              <div class="model-option '.concat(e===l?"selected":"",'" data-model="').concat(e,'">\n                <span class="model-option-indicator"></span>\n                ').concat(e,"\n              </div>\n            ")})),n+="</div>")})),t.innerHTML=n,t.querySelectorAll(".model-option").forEach((function(e){e.addEventListener("click",(function(t){t.stopPropagation(),function(e){l=e,chrome.storage&&chrome.storage.local&&chrome.storage.local.get(["aiChatSettings"],(function(t){var n=t.aiChatSettings||{};if(n.selectedModel=e,n.providers&&Array.isArray(n.providers)){n.providers.forEach((function(e){e.selectedProvider=!1}));var r=n.providers.find((function(t){return t.models&&Array.isArray(t.models)&&t.models.includes(e)}));r?(r.selectedProvider=!0,console.log("Switched to provider: ".concat(r.name," for model: ").concat(e))):console.warn("Could not find provider for model: ".concat(e,". Keeping current provider selection."))}chrome.storage.local.set({aiChatSettings:n})})),y();var t=r.querySelector(".model-dropdown-menu");if(t){t.classList.remove("open");var n=r.querySelector(".model-search-input");n&&(n.value="",w(""))}}(e.getAttribute("data-model"))}))}))}}}function w(e){if(r){var t=r.querySelectorAll(".model-option"),n=r.querySelectorAll(".model-provider-group");t.forEach((function(t){var n=t.getAttribute("data-model").toLowerCase().includes(e);t.style.display=n?"flex":"none"})),n.forEach((function(t){var n=t.querySelectorAll('.model-option[style*="flex"]'),r=t.querySelectorAll(".model-option"),o=n.length>0||""===e&&r.length>0;t.style.display=o?"block":"none"}))}}function x(){return(x=i(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=window.getSelection().toString().trim(),b(t,n),q(),e.next=6,k(t,n);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Error in handleNavAction:",e.t0),e.t0.message.includes("Extension context invalidated")&&alert("Extension was reloaded. Please refresh the page to continue using the extension.");case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function k(e,t){return E.apply(this,arguments)}function E(){return(E=i(o().mark((function e(t,n){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,H("Processing ".concat(t,"..."),!0),"translate"!==t){e.next=5;break}return e.next=5,T();case 5:if(0!==d.length){e.next=24;break}a={},e.t0=t,e.next="summarize"===e.t0||"summary"===e.t0?10:"explain"===e.t0?12:"rewrite"===e.t0?14:"translate"===e.t0?16:"grammar"===e.t0?19:21;break;case 10:return a.textSummary=n,e.abrupt("break",22);case 12:return a.content=n,e.abrupt("break",22);case 14:return a.textContent=n,e.abrupt("break",22);case 16:return a.languageName=s,a.text=n,e.abrupt("break",22);case 19:return a.selectedText=n,e.abrupt("break",22);case 21:throw new Error("Unknown action: ".concat(t));case 22:r=I(t,a),d=[{role:"user",content:r}];case 24:return e.next=26,O(t,n,d);case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(0),H(e.t1.message||"Failed to process request",!1,!0);case 31:case"end":return e.stop()}}),e,null,[[0,28]])})))).apply(this,arguments)}function S(e){return L.apply(this,arguments)}function L(){return(L=i(o().mark((function e(t){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,B("Message"),H("Processing your message...",!0),d.push({role:"user",content:t}),n=r.querySelector(".quick-panel-header span"),i=n.textContent.toLowerCase(),e.next=8,O(i,a,d);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),H(e.t0.message||"Failed to process message",!1,!0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function q(){e&&(e.style.display="none")}function C(e){e!==a&&(chrome.runtime&&chrome.runtime.sendMessage&&chrome.runtime.sendMessage({type:"SET_SELECTED_TEXT",text:e},(function(e){chrome.runtime.lastError&&console.log("Could not send message to sidebar:",chrome.runtime.lastError.message)})),a=e)}function T(){return A.apply(this,arguments)}function A(){return(A=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,z()){e.next=4;break}return s="English",e.abrupt("return");case 4:return e.next=6,new Promise((function(e,t){chrome.storage.local.get(["selectedLanguage"],(function(n){chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):e(n)}))}));case 6:t=e.sent,s=t.selectedLanguage||"English",e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("Using default language:",e.t0),s="English";case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function M(e){return P.apply(this,arguments)}function P(){return(P=i(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,z()){e.next=4;break}return s=t,e.abrupt("return");case 4:return s=t,e.next=7,new Promise((function(e,n){chrome.storage.local.set({selectedLanguage:t},(function(t){chrome.runtime.lastError?n(new Error(chrome.runtime.lastError.message)):e(t)}))}));case 7:e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("Error saving language preference:",e.t0),s=t;case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function z(){try{return chrome.runtime&&chrome.runtime.id}catch(e){return!1}}document.addEventListener("mouseup",(function(t){e&&e.contains(t.target)||setTimeout((function(){var e="",n=null,r=t.target;if(!r||"INPUT"!==r.tagName&&"TEXTAREA"!==r.tagName){var o=window.getSelection();(e=o.toString().trim())&&e.length>0&&(n=o.getRangeAt(0).getBoundingClientRect())}else{var a=r.selectionStart,i=r.selectionEnd;if(a!==i&&null!==a&&null!==i&&(e=r.value.substring(a,i).trim())&&e.length>0){var c=r.getBoundingClientRect();n={left:c.left,top:c.top}}}e&&e.length>0&&n?(g(n.left+window.scrollX,n.top+window.scrollY),C(e)):(q(),C(null))}),10)})),document.addEventListener("select",(function(t){var n=t.target;if(n&&("INPUT"===n.tagName||"TEXTAREA"===n.tagName)){if(e&&e.contains(n))return;setTimeout((function(){var e=n.selectionStart,t=n.selectionEnd;if(e!==t&&null!==e&&null!==t){var r=n.value.substring(e,t).trim();if(r&&r.length>0){var o=n.getBoundingClientRect(),a={left:o.left,top:o.top};g(a.left+window.scrollX,a.top+window.scrollY),C(r)}else q(),C(null)}}),10)}}));var N={summary:{name:"Summary",inputs:["Text summary"],prompt:'You are a highly skilled AI assistant tasked with summarizing text.\n\nHere is the text to summarize:\n"""\n{{textSummary}}\n"""\nSummarize the main content, theme, and purpose of the text in 2-3 concise sentences. Focus on the core message and intent without including unnecessary details.\nUse a clear, neutral, and professional tone. Ensure the output is engaging and easy to read, tailored to someone who wants a quick yet comprehensive overview of the text.\nOutput only the summary, no other text.\n'},explain:{name:"Explain",inputs:["Content"],prompt:'\nPlease explain the following text in simple terms:\n\n"{{content}}"\n\nYour explanation should be easy to understand and clear, suitable for someone with no prior knowledge of the topic.\nOutput only the explanation, no other text.\n'},rewrite:{name:"Rewrite",inputs:["Text content"],prompt:"#CONTEXT:\nYou are an editor improving the flow and readability of the content.\n#GOAL:\nRewrite the text below to make it concise, engaging, and easy to follow.\n#CONTENT:\n{{textContent}}\n#OUTPUT:\nA polished version of the content that is well-structured and reader-friendly. Output only the rewritten text, no other text."},translate:{name:"Translate",inputs:["Language Name","Text"],prompt:"Translate the text provided below into the specified target language.\n\nYour output must be only the translated text. Do not include explanations, greetings, or any additional conversational text.\n\nTarget Language: {{languageName}}\n\nText to Translate:\n{{text}}"},grammar:{name:"Fix Grammar",inputs:["Selected Text"],prompt:'You are a multilingual expert editor, proficient in grammar, spelling, punctuation, and style for numerous languages.\n\nYour task is to first identify the language of the following text. Then, correct the text in its original language. You must fix all grammatical errors, spelling mistakes, and punctuation issues. You should also improve sentence structure and word choice to enhance clarity and readability, while preserving the original meaning and tone.\n\nThe corrected text must be in the same language as the input text.\n\nDo not provide explanations, comments, or identify the language in your response. Your output must be only the corrected text.\n\nHere is the text to correct:\n"""\n{{selectedText}}\n"""'}};function I(e,t){var r={summarize:"summary",summary:"summary",explain:"explain",rewrite:"rewrite",translate:"translate",grammar:"grammar"}[e.toLowerCase()],o=N[r];if(!o)throw new Error("Unknown action: ".concat(e));var a=o.prompt;return Object.entries(t).forEach((function(e){var t,r,o=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],l=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);l=!0);}catch(e){s=!0,o=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(t,r)||n(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],c=o[1],l="{{".concat(i,"}}");a=a.replace(new RegExp(l,"g"),c)})),a}function O(e,t){return j.apply(this,arguments)}function j(){return j=i(o().mark((function e(n,r){var a,i,c,d,p,h,f,v,g,b,y,w,x,k,E,S,L,q,C,T,A,M,P,N,O=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=O.length>2&&void 0!==O[2]?O[2]:null,e.prev=1,z()){e.next=4;break}throw new Error("Extension context invalidated. Please refresh the page.");case 4:return e.next=6,new Promise((function(e,t){z()?chrome.storage.local.get(["aiChatSettings","selectedModel"],(function(n){chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):e(n)})):t(new Error("Extension context invalidated. Please refresh the page."))}));case 6:if(i=e.sent,u=i.aiChatSettings,c=i.selectedModel||l,u&&c){e.next=11;break}throw new Error("AI settings or model not configured");case 11:if(!(d=u.providers.find((function(e){return e.selectedProvider})))||d.models&&d.models.includes(c)||(console.log("Model ".concat(c," not found in selected provider ").concat(d.name,", searching for correct provider...")),(d=u.providers.find((function(e){return e.models&&Array.isArray(e.models)&&e.models.includes(c)})))&&console.log("Found correct provider: ".concat(d.name," for model: ").concat(c))),d){e.next=15;break}throw new Error("No provider found for model: ".concat(c));case 15:h={},e.t0=n,e.next="summarize"===e.t0||"summary"===e.t0?19:"explain"===e.t0?21:"rewrite"===e.t0?23:"translate"===e.t0?25:"grammar"===e.t0?28:30;break;case 19:return h.textSummary=r,e.abrupt("break",31);case 21:return h.content=r,e.abrupt("break",31);case 23:return h.textContent=r,e.abrupt("break",31);case 25:return h.languageName=s,h.text=r,e.abrupt("break",31);case 28:return h.selectedText=r,e.abrupt("break",31);case 30:throw new Error("Unknown action: ".concat(n));case 31:return a&&a.length>0?f=a:(p=I(n,h),f=[{role:"user",content:p}]),v={model:c,messages:f,temperature:.3,max_tokens:2e3,stream:!0},m=new AbortController,e.next=36,fetch(d.endpoint+"/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(d.apiKey)},body:JSON.stringify(v),signal:m.signal});case 36:if((g=e.sent).ok){e.next=39;break}throw new Error("API call failed: ".concat(g.status," ").concat(g.statusText));case 39:b=g.body.getReader(),y=new TextDecoder,w="",H("",!1,!1);case 43:if(!m||!m.signal.aborted){e.next=46;break}return e.abrupt("break",85);case 46:return e.next=48,b.read();case 48:if(x=e.sent,k=x.done,E=x.value,!k){e.next=53;break}return e.abrupt("break",85);case 53:S=y.decode(E),L=S.split("\n").filter((function(e){return""!==e.trim()})),q=t(L),e.prev=56,q.s();case 58:if((C=q.n()).done){e.next=75;break}if(!(T=C.value).startsWith("data: ")){e.next=73;break}if("[DONE]"!==(A=T.slice(6))){e.next=64;break}return e.abrupt("return",w);case 64:e.prev=64,P=JSON.parse(A),(N=null===(M=P.choices)||void 0===M||null===(M=M[0])||void 0===M||null===(M=M.delta)||void 0===M?void 0:M.content)&&H(w+=N,!1,!1),e.next=73;break;case 70:return e.prev=70,e.t1=e.catch(64),e.abrupt("continue",73);case 73:e.next=58;break;case 75:e.next=80;break;case 77:e.prev=77,e.t2=e.catch(56),q.e(e.t2);case 80:return e.prev=80,q.f(),e.finish(80);case 83:e.next=43;break;case 85:return a&&a.length>0&&a.push({role:"assistant",content:w}),m=null,e.abrupt("return",w);case 90:if(e.prev=90,e.t3=e.catch(1),m=null,"AbortError"!==e.t3.name){e.next=97;break}return console.log("AI stream cancelled by user"),H("AI response cancelled",!1,!1),e.abrupt("return","");case 97:throw console.error("AI API call error:",e.t3),e.t3;case 99:case"end":return e.stop()}}),e,null,[[1,90],[56,77,80,83],[64,70]])}))),j.apply(this,arguments)}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Response",t=p.length,n={id:t,label:"".concat(e," ").concat(t+1),content:"",timestamp:Date.now()};p.push(n),h=t;var o=r.querySelector(".response-tabs-content"),a=document.createElement("div");return a.className="tab-content",a.dataset.tab=t,a.innerHTML='<div class="action-result"></div>',o.appendChild(a),$(),R(t),t}function $(){var e=r.querySelector(".response-tabs"),t=r.querySelector(".response-tabs-header");e&&t&&(p.length>1?t.classList.add("show"):t.classList.remove("show"),e.innerHTML="",p.forEach((function(t,n){var o=document.createElement("div");o.className="response-tab ".concat(n===h?"active":""),o.dataset.tabId=t.id,o.innerHTML='\n        <span class="tab-label">'.concat(t.label,"</span>\n        ").concat(p.length>1?'<span class="tab-close" data-tab-id="'.concat(t.id,'">×</span>'):"","\n      "),o.addEventListener("click",(function(e){e.target.classList.contains("tab-close")||R(t.id)}));var a=o.querySelector(".tab-close");a&&a.addEventListener("click",(function(e){e.stopPropagation(),function(e){if(!(p.length<=1)){var t=p.findIndex((function(t){return t.id===e}));if(-1!==t){p.splice(t,1);var n=r.querySelector('[data-tab="'.concat(e,'"]'));n&&n.remove(),h>=t&&(h=Math.max(0,h-1)),$(),p.length>0&&R(p[h].id)}}}(t.id)})),e.appendChild(o)})),_())}function R(e){h=p.findIndex((function(t){return t.id===e})),r.querySelectorAll(".response-tab").forEach((function(t){t.classList.toggle("active",parseInt(t.dataset.tabId)===e)})),r.querySelectorAll(".tab-content").forEach((function(t){t.classList.toggle("active",parseInt(t.dataset.tab)===e)})),_()}function _(){var e=r.querySelector("#prev-tab"),t=r.querySelector("#next-tab");e&&(e.disabled=h<=0),t&&(t.disabled=h>=p.length-1)}function H(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=p[h];if(a){var i=null===(t=r)||void 0===t?void 0:t.querySelector('.tab-content[data-tab="'.concat(a.id,'"] .action-result'));i&&(n?i.innerHTML='\n        <div style="display: flex; align-items: center; gap: 8px; color: #ccc;">\n          <div style="width: 16px; height: 16px; border: 2px solid #8060F0; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>\n          '.concat(e,"\n        </div>\n      "):o?i.innerHTML='\n        <div style="color: #ff6b6b; font-size: 14px;">\n          <strong>Error:</strong> '.concat(e,"\n        </div>\n      "):(a.content=e,i.innerHTML=function(e){if(!e)return"";if(!document.getElementById("quick-panel-markdown-styles")){var t=document.createElement("style");t.id="quick-panel-markdown-styles",t.textContent="\n        .quick-panel-markdown { color: #e4e4e7; font-size: 14px; line-height: 1.6; }\n        .quick-panel-markdown h1 { font-size: 1.3rem; font-weight: bold; margin: 1rem 0 0.6rem; color: white; }\n        .quick-panel-markdown h2 { font-size: 1.15rem; font-weight: bold; margin: 0.8rem 0 0.5rem; color: white; }\n        .quick-panel-markdown h3 { font-size: 1.05rem; font-weight: bold; margin: 0.7rem 0 0.4rem; color: white; }\n        .quick-panel-markdown p { margin: 0.5rem 0; }\n        .quick-panel-markdown ul { padding-left: 1.2rem; margin: 0.5rem 0; list-style-type: disc; }\n        .quick-panel-markdown ol { padding-left: 1.2rem; margin: 0.5rem 0; list-style-type: decimal; }\n        .quick-panel-markdown li { margin: 0.3rem 0; padding-left: 1.2rem; }\n        .quick-panel-markdown li::marker { color: #737373; }\n        .quick-panel-markdown code { background-color: rgba(255, 255, 255, 0.1); padding: 0.1rem 0.3rem; border-radius: 3px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 0.85em; }\n        .quick-panel-markdown strong { font-weight: bold; color: white; }\n        .quick-panel-markdown em { font-style: italic; }\n        .quick-panel-markdown a { color: #3b82f6; text-decoration: underline; }\n        .quick-panel-markdown a:hover { text-decoration: none; }\n        .quick-panel-markdown blockquote { border-left: 3px solid #3b82f6; padding: 0.4rem 0 0.4rem 0.8rem; margin: 0.6rem 0; color: rgba(255, 255, 255, 0.7); background-color: rgba(59, 130, 246, 0.05); }\n        .quick-panel-markdown-code-block { position: relative; margin: 0.8rem 0; overflow: hidden; background-color: rgba(255, 255, 255, 0.05); border-radius: 4px; padding: 0.8rem; }\n        .quick-panel-markdown table { border-collapse: collapse; width: 100%; margin: 0.8rem 0; }\n        .quick-panel-markdown th { background-color: rgba(255, 255, 255, 0.1); padding: 0.4rem; text-align: left; font-weight: bold; font-size: 0.9em; }\n        .quick-panel-markdown td { padding: 0.4rem; border-top: 1px solid rgba(255, 255, 255, 0.1); font-size: 0.9em; }\n        .quick-panel-markdown tr:nth-child(even) { background-color: rgba(255, 255, 255, 0.05); }\n        .quick-panel-markdown-hr { border: 0; height: 1px; background: rgba(255, 255, 255, 0.2); margin: 1rem 0; }\n        .ai-thinking-container { margin: 0.8rem 0; border: 1px solid #3b4351; border-radius: 6px; overflow: hidden; }\n        .ai-thinking-header { display: flex; align-items: center; justify-content: space-between; padding: 0.6rem 0.8rem; background-color: #353940; cursor: pointer; }\n        .ai-thinking-title { display: flex; align-items: center; font-size: 0.75rem; font-weight: 600; color: #e4e4e7; }\n        .ai-thinking-title svg { margin-right: 0.4rem; }\n        .ai-thinking-content { padding: 0.8rem; font-size: 0.9rem; background-color: #1e1e1e; color: #a1a1aa; display: none; border-top: 1px solid #262626; }\n        .ai-thinking-content.show { display: block; }\n      ",document.head.appendChild(t)}var n=!1,r="",o=e,a=e.match(/<think>([\s\S]*?)<\/think>/);a&&(n=!0,r=a[1].trim(),o=e.replace(/<think>[\s\S]*?<\/think>/g,"").trim());var i=function(e){return e.replace(/```([\s\S]*?)```/g,(function(e,t){var n=t.replace(/</g,"&lt;").replace(/>/g,"&gt;");return'<div class="quick-panel-markdown-code-block">\n            <div>'.concat(n,"</div>\n          </div>")})).replace(/\|([^\n]*?)\|\n\|\s*:?-+:?\s*\|[^\n]*?\n([\s\S]*?)(?=\n\n|$)/g,(function(e,t,n){var r=t.split("|").map((function(e){return e.trim()})).filter(Boolean).map((function(e){return"<th>".concat(e,"</th>")})).join(""),o=n.split("\n").filter((function(e){return e.trim()&&e.includes("|")})).map((function(e){var t=e.split("|").map((function(e){return e.trim()})).filter(Boolean);return"<tr>".concat(t.map((function(e){return"<td>".concat(e,"</td>")})).join(""),"</tr>")})).join("");return"<table>\n            <thead><tr>".concat(r,"</tr></thead>\n            <tbody>").concat(o,"</tbody>\n          </table>")})).replace(/^---+$/gm,'<hr class="quick-panel-markdown-hr">').replace(/^### (.*$)/gm,"<h3>$1</h3>").replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/^\* (.*$)/gm,"<li>$1</li>").replace(/^- (.*$)/gm,"<li>$1</li>").replace(/^\d+\. (.*$)/gm,"<li>$1</li>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>').replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>").replace(/<\/li><br><li>/g,"</li><li>").replace(/<br><li>/g,"<ul><li>").replace(/<\/li><br>/g,"</li></ul>").replace(/<\/li>(?!<\/ul>)/g,"</li></ul>").replace(/<ul><\/ul>/g,"")},c=i(o);c.includes("<p>")||c.includes("<h1>")||c.includes("<h2>")||c.includes("<h3>")||c.includes("<ul>")||c.includes("<ol>")||(c="<p>".concat(c,"</p>"));var l='<div class="quick-panel-markdown">'.concat(c,"</div>");if(n){var s=i(r);l='\n        <div class="ai-thinking-container">\n          <div class="ai-thinking-header" onclick="this.nextElementSibling.classList.toggle(\'show\')">\n            <div class="ai-thinking-title">\n              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M9 12l2 2 4-4"/>\n                <circle cx="12" cy="12" r="10"/>\n              </svg>\n              AI Thinking Process\n            </div>\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <polyline points="6,9 12,15 18,9"/>\n            </svg>\n          </div>\n          <div class="ai-thinking-content quick-panel-markdown">\n            '.concat(s,"\n          </div>\n        </div>\n        ").concat(l,"\n      ")}return l}(e)))}}T(),document.addEventListener("mousedown",(function(t){e&&!e.contains(t.target)&&(q(),C(null))}))}()})();